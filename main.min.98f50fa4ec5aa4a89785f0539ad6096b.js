// 1599220025604
const debug=!0;var requestInfo={status:!1,reDraw:!1,time:(new Date).getTime(),text:"debug",meta:"none"};const callServer=google.script.run.withSuccessHandler(defaultSuccessHandler).withFailureHandler(defaultFailureHandler),classes={},queueExec=[];function defaultSuccessHandler(t){requestDone(t)}function defaultFailureHandler(t){alert("<hr>defaultFailureHandler return:<br>"+t),requestDone(t)}function requestLog(t,e=!0,s=!1){return!!requestInfo.status||(requestInfo.status=!0,requestInfo.time=(new Date).getTime(),requestInfo.text=t,requestInfo.reDraw=s,console.log("=> Running request "+requestInfo.text),!1)}function requestDone(t){$(".loader").fadeOut("slow"),requestInfo.status=!1,requestInfo.meta="none",console.log("=> Request '"+requestInfo.text+"' took "+((new Date).getTime()-requestInfo.time)/1e3+" seconds"),console.log(t),console.log("=========================================="),queueExec.length>0&&startQueueForAgentInfo()}function startQueueForAgentInfo(){let t=queueExec.shift();console.log(arguments.callee.name+" start exec with "+(adminList.includes(userEmail)?"all":userEmail)),t()}function requestInProgress(){return"=> Currently executing: "+requestInfo.text}function getNameFromEmail(t){var e=t.split("@")[0].split(".");return 1==e.length?e[0].charAt(0).toUpperCase()+e[0].slice(1):e[0].charAt(0).toUpperCase()+e[0].slice(1)+" "+e[1].charAt(0).toUpperCase()+e[1].slice(1)}function hashCode(t){for(var e=0,s=0;s<t.length;s++)e=t.charCodeAt(s)+((e<<5)-e);return e}function hexToRgb(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function intToHEX(t){var e=(16777215&t).toString(16).toUpperCase();return"00000".substring(0,6-e.length)+e}function getColorHEX(t){return"#"+intToHEX(hashCode(t))}function getColorRGB(t){return hexToRgb(getColorHEX(t))}function getRGBAString(t){const e=hexToRgb(getColorHEX(t));return`rgba(${e.r}, ${e.g}, ${e.b}, 0.6)`}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.getName=function(){let t="";return t=-1!=this.indexOf("-Agent-")?this.split("-")[2].split("@")[0].split(".")[0].charAt(0).toUpperCase()+this.split("-")[2].split("@")[0].split(".")[0].slice(1)+" "+this.split("-")[2].split("@")[0].split(".")[1].charAt(0).toUpperCase()+this.split("-")[2].split("@")[0].split(".")[1].slice(1):-1!=this.indexOf("@")?this.split("@")[0].split(".")[0].charAt(0).toUpperCase()+this.split("@")[0].split(".")[0].slice(1)+" "+this.split("@")[0].split(".")[1].charAt(0).toUpperCase()+this.split("@")[0].split(".")[1].slice(1):this.split(".")[0].charAt(0).toUpperCase()+this.split(".")[0].slice(1)+" "+this.split(".")[1].charAt(0).toUpperCase()+this.split(".")[1].slice(1),t};class localStorageSingletone{constructor(){this.storages=new Map}add(t,e){this.storages.set(t,e)}get(t){return this.storages.get(t)}}const localStorages=new localStorageSingletone;class CRMAppStats{constructor(t){this.class=CRMAppStats,this.count=0,t?(this.date=t.date,this.time=t.time,this.total=t.total,this.typeDirect=t.typeDirect,this.typePS=t.typePS,this.typeOB=t.typeOB,this.typeTS=t.typeTS,this.suitePro=t.suitePro,this.suiteEnt=t.suiteEnt,this.suiteBsc=t.suiteBsc,this.imports=t.imports,this.outCompleted=t.outCompleted,this.outRescheduled=t.outRescheduled,this.outDeclined=t.outDeclined,this.outNoShow=t.outNoShow,this.rules=t.rules,this.calendar=t.calendar,this.stopics=t.stopics,this.analytics=t.analytics,this.surveys=t.surveys,this.chat=t.chat,this.other=t.other,this.successComplete=t.successComplete):(this.date="",this.time=0,this.total=0,this.typeDirect=0,this.typePS=0,this.typeOB=0,this.typeTS=0,this.suitePro=0,this.suiteEnt=0,this.suiteBsc=0,this.imports=0,this.outCompleted=0,this.outRescheduled=0,this.outDeclined=0,this.outNoShow=0,this.rules=0,this.calendar=0,this.stopics=0,this.analytics=0,this.surveys=0,this.chat=0,this.other=0,this.successComplete=0)}add(t){this.count++,this.date||(this.date=t.date),this.time||(this.time=t.time),this.total+=t.total,this.typeDirect+=t.typeDirect,this.typePS+=t.typePS,this.typeOB+=t.typeOB,this.typeTS+=t.typeTS,this.suitePro+=t.suitePro,this.suiteEnt+=t.suiteEnt,this.suiteBsc+=t.suiteBsc,this.imports+=t.imports,this.outCompleted+=t.outCompleted,this.outRescheduled+=t.outRescheduled,this.outDeclined+=t.outDeclined,this.outNoShow+=t.outNoShow,this.rules+=t.rules,this.calendar+=t.calendar,this.stopics+=t.stopics,this.analytics+=t.analytics,this.surveys+=t.surveys,this.chat+=t.chat,this.other+=t.other,this.successComplete+=t.successComplete}}classes.CRMAppStats=CRMAppStats,localStorages.add("CRMAppStats",new Map);class DatePickrControl{constructor(){this.initiated=!1,this.pickrFrom,this.pickrTo}getToTime(){return this.pickrTo.selectedDates[0].setHours(23,59,59,59)}getFromTime(){return this.pickrFrom.selectedDates[0].setHours(0,0,0,1)}getTo(){return this.pickrTo.selectedDates[0]}getFrom(){return this.pickrFrom.selectedDates[0]}init(){if(this.initiated)return console.error("DatePickrControl initiation more than 1 time");this.initiated=!0,this.pickrFrom=this.createFromPickr(),this.pickrTo=this.createToPickr()}createFromPickr(){return flatpickr("#flatpickr-obt-fromdate",{maxDate:"today",altInput:!0,altFormat:"F j, Y",defaultDate:[new Date((new Date).setDate((new Date).getDate()-7))],dateFormat:"Y-m-d",locale:{firstDayOfWeek:1},onChange:function(t,e,s){1==t.length&&updateToPickr(t[0])},getWeek:function(t){}})}createToPickr(){return flatpickr("#flatpickr-obt-todate",{maxDate:"today",altInput:!0,altFormat:"F j, Y",defaultDate:["today"],dateFormat:"Y-m-d",locale:{firstDayOfWeek:1},onChange:function(t,e,s){1==t.length&&updateFromPickr(t[0])},getWeek:function(t){}})}}const dateSelector=new DatePickrControl;function updateFromPickr(t){dateSelector.pickrFrom.config.disable=[function(e){return moment(e)>moment(t)}],dateSelector.pickrFrom.redraw(),runUpdate()}function updateToPickr(t){dateSelector.pickrTo.config.disable=[function(e){return moment(e)<moment(t)}],dateSelector.pickrTo.redraw(),runUpdate()}dateSelector.init();class FTAppStats{constructor(t){this.class=FTAppStats,this.count=0,t?(this.date=t.date,this.time=t.time,this.total=t.total,this.made=t.made,this.noshow=t.noshow,this.declined=t.declined,this.reschedule=t.reschedule):(this.date="",this.time=0,this.total=0,this.made=0,this.noshow=0,this.declined=0,this.reschedule=0)}add(t){this.date||(this.date=t.date),this.time||(this.time=t.time),this.count++,this.total+=t.total,this.made+=t.made,this.noshow+=t.noshow,this.declined+=t.declined,this.reschedule+=t.reschedule}}classes.FTAppStats=FTAppStats,localStorages.add("FTAppStats",new Map);class FTCompletionStats{constructor(t){this.class=FTCompletionStats,this.count=0,t?(this.date=t.date,this.time=t.time,this.total=t.total,this.confirmed=t.confirmed,this.passive=t.passive,this.declined=t.declined,this.cancel=t.cancel):(this.date="",this.time=0,this.total=0,this.confirmed=0,this.passive=0,this.declined=0,this.cancel=0)}add(t){this.date||(this.date=t.date),this.time||(this.time=t.time),this.count++,this.total+=t.total,this.confirmed+=t.confirmed,this.passive+=t.passive,this.declined+=t.declined,this.cancel+=t.cancel}}classes.FTCompletionStats=FTCompletionStats,localStorages.add("FTCompletionStats",new Map);class OBContactsStats{constructor(t){this.class=OBContactsStats,this.count=0,t?(this.date=t.date,this.time=t.time,this.name=t.name,this.team=t.team,this.zero3=t.zero3,this.four=t.four,this.fiveplus=t.fiveplus,this.zero3perc=t.zero3perc,this.fourperc=t.fourperc,this.fiveplus=t.fiveplus,this.total=t.total,this.totalperc=t.totalperc):(this.date=0,this.time=0,this.name=0,this.team=0,this.zero3=0,this.four=0,this.fiveplus=0,this.zero3perc=0,this.fourperc=0,this.fiveplus=0,this.total=0,this.totalperc=0)}add(t){this.date||(this.date=t.date),this.time||(this.time=t.time),this.name||(this.name=t.name),this.team||(this.team=t.team),this.zero3+=t.zero3,this.four+=t.four,this.fiveplus+=t.fiveplus,this.zero3perc+=t.zero3perc,this.fourperc+=t.fourperc,this.fiveplus+=t.fiveplus,this.total+=t.total,this.totalperc+=t.totalperc}}classes.OBContactsStats=OBContactsStats,localStorages.add("OBContactsStats",new Map);class OBPortfolioStats{constructor(t){this.class=OBPortfolioStats,this.count=0,t?(this.date="",this.time=0,this.pm=t.pm,this.queue=t.queue,this.beg=t.beg,this.endportfolio=t.endportfolio,this.portfolio=t.portfolio,this.lcyesterday=t.lcyesterday,this.notcontacted48h=t.notcontacted48h,this.notcontacted72h=t.notcontacted72h,this.t1createdyesterday=t.t1createdyesterday,this.t1createdalltime=t.t1createdalltime,this.inboundcalls=t.inboundcalls,this.outboundcalls=t.outboundcalls,this.internalcalls=t.internalcalls,this.totalcalls=t.totalcalls,this.tickets=t.tickets,this.totaltolktime=t.totaltolktime,this.callsporfolioratio=t.callsporfolioratio):(this.date="",this.time=0,this.pm="",this.queue=0,this.beg=0,this.endportfolio=0,this.portfolio=0,this.lcyesterday=0,this.notcontacted48h=0,this.notcontacted72h=0,this.t1createdyesterday=0,this.t1createdalltime=0,this.inboundcalls=0,this.outboundcalls=0,this.internalcalls=0,this.totalcalls=0,this.tickets=0,this.totaltolktime=0,this.callsporfolioratio=0)}add(t){this.total++,this.date||(this.date=t.date),this.time||(this.time=t.time),this.pm||(this.pm=t.pm),this.queue||(this.queue=t.queue),this.beg+=t.beg,this.endportfolio+=t.endportfolio,this.portfolio+=t.portfolio,this.lcyesterday+=t.lcyesterday,this.notcontacted48h+=t.notcontacted48h,this.notcontacted72h+=t.notcontacted72h,this.t1createdyesterday+=t.t1createdyesterday,this.t1createdalltime+=t.t1createdalltime,this.inboundcalls+=t.inboundcalls,this.outboundcalls+=t.outboundcalls,this.internalcalls+=t.internalcalls,this.totalcalls+=t.totalcalls,this.tickets+=t.tickets,this.totaltolktime+=getseconds(t.totaltolktime),this.callsporfolioratio+=t.callsporfolioratio}}classes.OBPortfolioStats=OBPortfolioStats,localStorages.add("OBPortfolioStats",new Map);class OBTAppStats{constructor(t){this.class=OBTAppStats,t?(this.date=t.date,this.time=t.time,this.total=t.total,this.typeImpl=t.typeImpl,this.typeNet=t.typeNet,this.typeTS=t.typeTS,this.typeTR=t.typeTR,this.typeOCS=t.typeOCS,this.outMade=t.outMade):(this.date="",this.time=0,this.total=0,this.typeImpl=0,this.typeNet=0,this.typeTS=0,this.typeTR=0,this.typeOCS=0,this.outMade=0)}add(t){this.date||(this.date=t.date),this.time||(this.time=t.time),this.count++,this.total+=t.total,this.typeImpl+=t.typeImpl,this.typeNet+=t.typeNet,this.typeTS+=t.typeTS,this.typeTR+=t.typeTR,this.typeOCS+=t.typeOCS,this.outMade+=t.outMade}}classes.OBTAppStats=OBTAppStats,localStorages.add("OBTAppStats",new Map);class OBTCasesStats{constructor(t){this.class=OBTCasesStats,t?(this.date=t.date,this.time=t.time,this.total=t.total,this.builds=t.builds,this.updates=t.updates,this.assignments=t.assignments,this.mid=t.mid,this.enterprise=t.enterprise,this.fasttrack=t.fasttrack,this.migration=t.migration,this.insidesales=t.insidesales,this.channel=t.channel,this.franchise=t.franchise,this.otherSale=t.otherSale,this.usersCreated=t.usersCreated,this.usersUpdated=t.usersUpdated,this.featuresCreated=t.featuresCreated,this.featuresUpdated=t.featuresUpdated,this.servicesCreated=t.servicesCreated,this.servicesUpdated=t.servicesUpdated,this.other=t.other):(this.date="",this.time=0,this.total=0,this.builds=0,this.updates=0,this.assignments=0,this.mid=0,this.enterprise=0,this.fasttrack=0,this.migration=0,this.insidesales=0,this.channel=0,this.franchise=0,this.otherSale=0,this.usersCreated=0,this.usersUpdated=0,this.featuresCreated=0,this.featuresUpdated=0,this.servicesCreated=0,this.servicesUpdated=0,this.other=0)}add(t){this.date||(this.date=t.date),this.time||(this.time=t.time),this.total+=t.total,this.builds+=t.builds,this.updates+=t.updates,this.assignments+=t.assignments,this.mid+=t.mid,this.enterprise+=t.enterprise,this.fasttrack+=t.fasttrack,this.migration+=t.migration,this.insidesales+=t.insidesales,this.channel+=t.channel,this.franchise+=t.franchise,this.otherSale+=t.otherSale,this.usersCreated+=t.usersCreated,this.usersUpdated+=t.usersUpdated,this.featuresCreated+=t.featuresCreated,this.featuresUpdated+=t.featuresUpdated,this.servicesCreated+=t.servicesCreated,this.servicesUpdated+=t.servicesUpdated,this.other+=t.other}}classes.OBTCasesStats=OBTCasesStats,localStorages.add("OBTCasesStats",new Map),localStorages.add("teamRoaster",new Map),$(window).on("load",(function(){if(console.log("=> Page took to load "+((new Date).getTime()-timePageLoading)/1e3+" seconds"),requestLog(arguments.callee.name))return showAlert(requestInProgress());callServer.withSuccessHandler(onDataLoaded).getStorage()}));const onLoadQueue=[];function onDataLoaded(t){console.groupCollapsed("Saving Stats Log");for(const e of t[1])saveStats(e);console.groupEnd(),onLoadQueue.forEach(e=>{e(t)}),$(".obt-dashboard-page-container:not(:first-of-type)").hide(),runUpdate(),requestDone(t)}const updateQueue=[],countQueue=[];function runUpdate(){countQueue.forEach(t=>{t()}),updateQueue.forEach(t=>{t()})}function combineByDate(t,e,s){if("Agent"===t[1]||"teamRoaster"===t[0])return;let a=localStorages["by"+t[1]].get(t[2]);a||(a={time:s.time}),a[e]=new classes[e](s),localStorages["by"+t[1]].set(t[2],a)}localStorages.byDate=new Map,localStorages.byMonth=new Map,localStorages.byYear=new Map,$(".obt-dashboard-left-menu-item").on("click",(function(t){$(".obt-dashboard-page-container").hide(),$(".obt-dashboard-left-menu-item").removeClass("active"),$(this).addClass("active");const e=$(this).attr("page");$("#obt-dashboard-page-"+e).show()}));class leftMenuSingletone{constructor(){}updateName(t){$("#obt-dashboard-left-menu-username").text(getNameFromEmail(t[0])),$("#obt-dashboard-left-menu-avatar").attr("src",`https://icotar.com/avatar/${t[0].split("@")[0]}.png?s=500`)}}const leftMenu=new leftMenuSingletone;function saveStats(t){const e=t[0].split("-"),s=localStorages.get(e[0]);try{let a=JSON.parse(t[2]);"Array"==t[1]?s.set(t[0],a):(s.set(t[0],new classes[t[1]](a)),combineByDate(e,t[1],a))}catch(e){console.log(`storage.set(${t[0]}, new classes[${t[1]}](JSON.parse()));`),console.log("error",e)}}onLoadQueue.push(leftMenu.updateName);const statsTypes=["OBTCasesStats","OBTAppStats","FTCompletionStats","CRMAppStats"];function countWorkDays(t,e){const s=new Date(t),a=new Date(e);s.setHours(0,0,0,1),a.setHours(23,59,59,999);let o=a-s,i=Math.ceil(o/864e5);i-=2*Math.floor(i/7);let r=s.getDay(),n=a.getDay();r-n>1&&(i-=2),0==r&&6!=n&&i--,6==n&&0!=r&&i--}function countPeriods(){const t=dateSelector.getFromTime(),e=dateSelector.getToTime();console.log(t);const s={text:"",from:t,to:e},a=countWorkDays(t,e);console.log(`Selected ${a} work days.`);const o={text:"",from:t-(e-t),to:t-1e3};console.groupCollapsed("==********[ countPeriods ]*********=="),console.log("crntPeriod",s),console.log("prvsPeriod",o),console.groupCollapsed("Included list"),statsTypes.forEach(t=>{const e=localStorages.get(t);console.log("==*********************************=="),console.log("-------------------------------------"),console.log("Working with "+t),console.log(e),console.log("-------------------------------------"),s.text=t+"-CurrentPeriod",o.text=t+"-PreviousePeriod",e.set(s.text,""),e.set(o.text,""),e.forEach((t,a)=>{if(-1!==a.indexOf("-Date-"))if(t.time>=s.from&&t.time<=s.to){console.log("included in current period",t);let a=e.get(s.text);a||(a=new t.class),a.add(t),e.set(s.text,a)}else if(t.time>=o.from&&t.time<=o.to){console.log("included in previouse period",t);let s=e.get(o.text);s||(s=new t.class),s.add(t),e.set(o.text,s)}})}),console.groupEnd(),console.log("==*********************************=="),console.groupEnd()}countQueue.push(countPeriods);class dashFTchartSingletone{constructor(){this.chart=echarts.init(document.getElementById("dashboard-chart-ft-completions"))}update(){const t=localStorages.get("FTCompletionStats"),e=[],s=[],a=[],o=[],i=[],r=dateSelector.getFromTime(),n=dateSelector.getToTime();t.forEach((t,l)=>{-1!==l.indexOf("-Date-")&&t.time>=r&&t.time<=n&&(e.push(makeMMDDYYYY(t.time)),s.push(t.confirmed),a.push(t.declined),o.push(t.passive),i.push(t.cancel))}),dashFTComplChart.init({legend:["Confirmed","Declined","Passive","Cancel"],labels:e,colors:[],series:[{name:"Confirmed",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{type:"default"}}},data:s},{name:"Declined",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{type:"default"}}},data:a},{name:"Passive",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{type:"default"}}},data:o},{name:"Cancel",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{type:"default"}}},data:i}]})}init(t){t||(t={legend:["Confirmed","Declined","Passive","Cancel"],labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],series:[{name:"Confirmed"},{name:"Declined"},{name:"Passive"},{name:"Cancel"}],colors:[getRGBAString("Confirmed"),getRGBAString("Declined"),getRGBAString("Passive"),getRGBAString("Cancel")]}),this.chart.setOption({tooltip:{trigger:"axis"},legend:{textStyle:{color:"#9aa0ac"},data:t.legend},toolbox:{show:!1},calculable:!1,xAxis:[{type:"category",data:t.labels,axisLabel:{fontSize:10,color:"#9aa0ac"}}],yAxis:[{type:"value",axisLabel:{fontSize:10,color:"#9aa0ac"}}],series:t.series,color:t.colors})}}const dashFTComplChart=new dashFTchartSingletone;dashFTComplChart.init(),updateQueue.push(dashFTComplChart.update);class dashOBTCasesChartSingletone{constructor(){this.chart=echarts.init(document.getElementById("dashboard-chart-obt-cases"))}init(t){t||(t={category:["2000","2001","2002","2003","2004","2005"],builds:[22,54,37,23,25.6,76],assignments:[35,45,47,10,35,70],updates:[11,25,45,15,25,40]}),this.chart.setOption({responsive:!0,maintainAspectRatio:!1,tooltip:{trigger:"axis"},legend:{textStyle:{color:"#9aa0ac"},data:["Builds","Assignments","Updates"]},toolbox:{show:1},calculable:1,xAxis:[{type:"category",data:t.category,axisLabel:{fontSize:10,color:"#9aa0ac"}}],yAxis:[{type:"value",axisLabel:{fontSize:10,color:"#9aa0ac"}}],series:[{name:"Builds",type:"bar",data:t.builds,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}},{name:"Assignments",type:"bar",data:t.assignments,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}},{name:"Updates",type:"bar",data:t.updates,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}}],color:["#65a986","#4f8bb7","#d68e41"]})}getChartMode(t,e){let s=(e-t)/24/60/60/1e3;return s<60?"Date":s<700?"Month":"Year"}update(){const t=localStorages.get("OBTCasesStats"),e=[],s=[],a=[],o=[],i=dateSelector.getFromTime(),r=dateSelector.getToTime();let n=dashOBTCasesChart.getChartMode(i,r);t.forEach((t,l)=>{-1!==l.indexOf(`-${n}-`)&&t.time>=i&&t.time<=r&&("Date"==n?e.push(makeMMDDYYYY(t.time)):"Month"==n?e.push(makeMMMYYYY(t.time)):e.push(makeYYYY(t.time)),s.push(t.builds),a.push(t.assignments),o.push(t.updates))}),dashOBTCasesChart.init({category:e,builds:s,assignments:a,updates:o})}}const dashOBTCasesChart=new dashOBTCasesChartSingletone;dashOBTCasesChart.init(),updateQueue.push(dashOBTCasesChart.update);class dashTotalChartSingletone{constructor(){this.chart=echarts.init(document.getElementById("dashboard-chart-total-main"))}init(t){t||(t={category:["2000","2001","2002","2003","2004","2005"],cases:[22,54,37,23,25.6,76],appointments:[35,45,47,10,35,70]}),this.chart.setOption({responsive:!0,maintainAspectRatio:!1,tooltip:{trigger:"axis"},legend:{textStyle:{color:"#9aa0ac"},data:["Cases","Appointments"]},toolbox:{show:1},calculable:1,xAxis:[{type:"category",data:t.category,axisLabel:{fontSize:10,color:"#9aa0ac"}}],yAxis:[{type:"value",axisLabel:{fontSize:10,color:"#9aa0ac"}}],series:[{name:"Cases",type:"line",smooth:!0,symbol:"none",stack:"a",areaStyle:{normal:{}},data:t.cases},{name:"Appointments",type:"line",smooth:!0,symbol:"none",stack:"a",areaStyle:{normal:{}},data:t.appointments}],color:["#65a986","#4f8bb7"]})}getChartMode(t,e){let s=(e-t)/24/60/60/1e3;return s<60?"Date":s<700?"Month":"Year"}update(){const t=dateSelector.getFromTime(),e=dateSelector.getToTime(),s={category:[],cases:[],appointments:[]};let a=dashTotalChart.getChartMode(t,e);localStorages["by"+a].forEach((o,i)=>{o.time>=t&&o.time<=e&&("Date"==a?s.category.push(makeMMDDYYYY(o.time)):"Month"==a?s.category.push(makeMMMYYYY(o.time)):s.category.push(makeYYYY(o.time)),s.cases.push(o.OBTCasesStats.total),s.appointments.push(o.OBTAppStats.total))}),this.chart.setOption({xAxis:{data:s.category},series:[{name:"Cases",type:"bar",data:s.cases},{name:"Appointments",type:"bar",data:s.appointments}]})}}const dashTotalChart=new dashTotalChartSingletone;dashTotalChart.init(),updateQueue.push(dashTotalChart.update);const DashboardCards=["OBTCasesStats","OBTAppStats","FTCompletionStats","CRMAppStats"];function getDashboardCardsStats(){const t={};return DashboardCards.forEach(e=>{const s=localStorages.get(e),a=s.get(e+"-PreviousePeriod"),o=s.get(e+"-CurrentPeriod"),i=0==a.total?101:Math.round(o.total/a.total*1e4)/100,r={number:o.total?o.total:0,progress:(i||0)+"%",arrow:a.total<=o.total,percents:(i?Math.round(100*Math.abs(i-100))/100:0)+"%",last:a.total?a.total:0};t[e]=r}),console.log("getDashboardCardsStats",t),t}function updateAllDashboardCards(){const t=getDashboardCardsStats();for(const e of DashboardCards)updateDashboardCard(e,t[e])}function updateDashboardCard(t,e){const s=document.getElementById(`dashboard-top-card-${t}-this-month`),a=document.getElementById(`dashboard-top-card-${t}-progressbar`),o=document.getElementById(`dashboard-top-card-${t}-compare-to-last-month-percents`);s.innerHTML=e.number+` (prev. ${e.last})`,a.setAttribute("style",`width: ${e.progress};`),o.innerHTML=`<i class="fa fa-arrow-${e.arrow?"up":"down"}"></i> ${e.percents}`}updateQueue.push(updateAllDashboardCards);class obtCasesByTeamProgressObject{constructor(){this.total=0,this.percents=0}}class obtCasesByTeamTotalSingletone{constructor(){this.total=0,this.midmarket=new obtCasesByTeamProgressObject,this.enterprise=new obtCasesByTeamProgressObject,this.fasttrack=new obtCasesByTeamProgressObject,this.migration=new obtCasesByTeamProgressObject,this.insidesales=new obtCasesByTeamProgressObject,this.channel=new obtCasesByTeamProgressObject,this.franchise=new obtCasesByTeamProgressObject,this.otherSale=new obtCasesByTeamProgressObject}sum(){this.total=this.midmarket.total+this.enterprise.total+this.fasttrack.total+this.migration.total+this.otherSale.total}percents(){if(0==this.total)return console.log("!!!!!!! obtCasesByTeamTotalSingletone total is equal to 0");this.midmarket.percents=Math.floor(this.midmarket.total/this.total*100),this.enterprise.percents=Math.floor(this.enterprise.total/this.total*100),this.fasttrack.percents=Math.floor(this.fasttrack.total/this.total*100),this.migration.percents=Math.floor(this.migration.total/this.total*100),this.otherSale.percents=Math.floor(this.otherSale.total/this.total*100)}}class obtChartCasesByTeamSingletone{constructor(){this.chart=echarts.init(document.getElementById("obt-chart-cases-by-team"))}init(t){t||(t={category:["2000","2001","2002","2003","2004","2005"],mid:[22,54,37,23,25.6,76],enterprise:[35,45,47,10,35,70],fasttrack:[11,25,45,15,25,40],migration:[11,25,45,15,25,40],insidesales:[11,25,45,15,25,40],channel:[11,25,45,15,25,40],franchise:[11,25,45,15,25,40],otherSale:[11,25,45,15,25,40]}),this.chart.setOption({tooltip:{trigger:"axis"},legend:{textStyle:{color:"#9aa0ac"},data:["Mid Market","Enterprise","Fast Track","Migrations","Other"]},toolbox:{show:1},calculable:1,xAxis:[{type:"category",data:t.category,axisLabel:{fontSize:10,color:"#9aa0ac"}}],yAxis:[{type:"value",axisLabel:{fontSize:10,color:"#9aa0ac"}}],series:[{name:"Mid Market",type:"bar",data:t.mid,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}},{name:"Enterprise",type:"bar",data:t.enterprise,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}},{name:"Fast Track",type:"bar",data:t.fasttrack,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}},{name:"Migrations",type:"bar",data:t.migration,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}},{name:"Other",type:"bar",data:t.otherSale,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}}],color:["#876a6c","#8ca8b0","#264e70","#d2c3a7","#7f9413"]})}getChartMode(t,e){let s=(e-t)/24/60/60/1e3;return s<60?"Date":s<700?"Month":"Year"}update(){const t=localStorages.get("OBTCasesStats"),e=[],s=[],a=[],o=[],i=[],r=[],n=dateSelector.getFromTime(),l=dateSelector.getToTime(),c=new obtCasesByTeamTotalSingletone;let h=obtChartCasesByTeam.getChartMode(n,l);t.forEach((t,d)=>{-1!==d.indexOf(`-${h}-`)&&t.time>=n&&t.time<=l&&("Date"==h?e.push(makeMMDDYYYY(t.time)):"Month"==h?e.push(makeMMMYYYY(t.time)):e.push(makeYYYY(t.time)),s.push(t.mid),c.midmarket.total+=parseInt(t.mid),a.push(t.enterprise),c.enterprise.total+=parseInt(t.enterprise),o.push(t.fasttrack),c.fasttrack.total+=parseInt(t.fasttrack),i.push(t.migration),c.migration.total+=parseInt(t.migration),r.push(t.otherSale+t.franchise+t.channel+t.insidesales),c.otherSale.total+=parseInt(t.otherSale+t.franchise+t.channel+t.insidesales))}),c.sum(),c.percents(),updateOBTCasesByTeamProgress(c),obtChartCasesByTeam.init({category:e,mid:s,enterprise:a,fasttrack:o,migration:i,otherSale:r})}}const obtChartCasesByTeam=new obtChartCasesByTeamSingletone;function updateOBTCasesByTeamProgress(t){document.getElementById("obt-cases-by-team-progress-total-cases").innerHTML=t.total,document.getElementById("obt-cases-by-team-progress-midmarket-total-cases").innerHTML=t.midmarket.total,document.getElementById("obt-cases-by-team-progress-midmarket-percents").innerHTML=t.midmarket.percents+"%",document.getElementById("obt-cases-by-team-progress-midmarket-progress-bar").style.width=t.midmarket.percents+"%",document.getElementById("obt-cases-by-team-progress-enterprise-total-cases").innerHTML=t.enterprise.total,document.getElementById("obt-cases-by-team-progress-enterprise-percents").innerHTML=t.enterprise.percents+"%",document.getElementById("obt-cases-by-team-progress-enterprise-progress-bar").style.width=t.enterprise.percents+"%",document.getElementById("obt-cases-by-team-progress-fasttrack-total-cases").innerHTML=t.fasttrack.total,document.getElementById("obt-cases-by-team-progress-fasttrack-percents").innerHTML=t.fasttrack.percents+"%",document.getElementById("obt-cases-by-team-progress-fasttrack-progress-bar").style.width=t.fasttrack.percents+"%",document.getElementById("obt-cases-by-team-progress-migration-total-cases").innerHTML=t.migration.total,document.getElementById("obt-cases-by-team-progress-migration-percents").innerHTML=t.migration.percents+"%",document.getElementById("obt-cases-by-team-progress-migration-progress-bar").style.width=t.migration.percents+"%",document.getElementById("obt-cases-by-team-progress-otherSale-total-cases").innerHTML=t.otherSale.total,document.getElementById("obt-cases-by-team-progress-otherSale-percents").innerHTML=t.otherSale.percents+"%",document.getElementById("obt-cases-by-team-progress-otherSale-progress-bar").style.width=t.otherSale.percents+"%"}obtChartCasesByTeam.init(),updateQueue.push(obtChartCasesByTeam.update);class obtCasesByTypeProgressObject{constructor(){this.total=0,this.percents=0}}class obtCasesByTypeTotalSingletone{constructor(){this.total=0,this.builds=new obtCasesByTypeProgressObject,this.assignments=new obtCasesByTypeProgressObject,this.updates=new obtCasesByTypeProgressObject}sum(){this.total=this.builds.total+this.assignments.total+this.updates.total}percents(){if(0==this.total)return console.log("!!!!!!! obtCasesByTypeTotalSingletone total is equal to 0");this.builds.percents=Math.floor(this.builds.total/this.total*100),this.assignments.percents=Math.floor(this.assignments.total/this.total*100),this.updates.percents=Math.floor(this.updates.total/this.total*100)}}class obtChartCasesByTypeSingletone{constructor(){this.chart=echarts.init(document.getElementById("obt-chart-cases-by-type"))}init(t){t||(t={category:["2000","2001","2002","2003","2004","2005"],builds:[22,54,37,23,25.6,76],assignments:[35,45,47,10,35,70],updates:[11,25,45,15,25,40]}),this.chart.setOption({tooltip:{trigger:"axis"},legend:{textStyle:{color:"#9aa0ac"},data:["Builds","Assignments","Updates"]},toolbox:{show:1},calculable:1,xAxis:[{type:"category",data:t.category,axisLabel:{fontSize:10,color:"#9aa0ac"}}],yAxis:[{type:"value",axisLabel:{fontSize:10,color:"#9aa0ac"}}],series:[{name:"Builds",type:"bar",data:t.builds,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}},{name:"Assignments",type:"bar",data:t.assignments,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}},{name:"Updates",type:"bar",data:t.updates,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}}],color:["#65a986","#4f8bb7","#d68e41"]})}getChartMode(t,e){let s=(e-t)/24/60/60/1e3;return s<60?"Date":s<700?"Month":"Year"}update(){const t=localStorages.get("OBTCasesStats"),e=[],s=[],a=[],o=[],i=dateSelector.getFromTime(),r=dateSelector.getToTime(),n=new obtCasesByTypeTotalSingletone;let l=obtChartCasesByType.getChartMode(i,r);t.forEach((t,c)=>{-1!==c.indexOf(`-${l}-`)&&t.time>=i&&t.time<=r&&("Date"==l?e.push(makeMMDDYYYY(t.time)):"Month"==l?e.push(makeMMMYYYY(t.time)):e.push(makeYYYY(t.time)),s.push(t.builds),n.builds.total+=parseInt(t.builds),a.push(t.assignments),n.assignments.total+=parseInt(t.assignments),o.push(t.updates),n.updates.total+=parseInt(t.updates))}),n.sum(),n.percents(),updateOBTCasesByTypeProgress(n),obtChartCasesByType.init({category:e,builds:s,assignments:a,updates:o})}}const obtChartCasesByType=new obtChartCasesByTypeSingletone;function updateOBTCasesByTypeProgress(t){document.getElementById("obt-cases-by-type-progress-total-cases").innerHTML=t.total,document.getElementById("obt-cases-by-type-progress-builds-total-cases").innerHTML=t.builds.total,document.getElementById("obt-cases-by-type-progress-builds-percents").innerHTML=t.builds.percents+"%",document.getElementById("obt-cases-by-type-progress-builds-progress-bar").style.width=t.builds.percents+"%",document.getElementById("obt-cases-by-type-progress-assignments-total-cases").innerHTML=t.assignments.total,document.getElementById("obt-cases-by-type-progress-assignments-percents").innerHTML=t.assignments.percents+"%",document.getElementById("obt-cases-by-type-progress-assignments-progress-bar").style.width=t.assignments.percents+"%",document.getElementById("obt-cases-by-type-progress-updates-total-cases").innerHTML=t.updates.total,document.getElementById("obt-cases-by-type-progress-updates-percents").innerHTML=t.updates.percents+"%",document.getElementById("obt-cases-by-type-progress-updates-progress-bar").style.width=t.updates.percents+"%"}obtChartCasesByType.init(),updateQueue.push(obtChartCasesByType.update);class obtChartCasesPerAgentSingletone{constructor(){this.chart=echarts.init(document.getElementById("obt-chart-cases-per-agent"))}init(t){t||(t={category:["2000","2001","2002","2003","2004","2005"],builds:[22,54,37,23,25.6,76],assignments:[35,45,47,10,35,70],updates:[11,25,45,15,25,40]}),this.chart.setOption({tooltip:{trigger:"axis"},legend:{textStyle:{color:"#9aa0ac"},data:["Builds","Assignments","Updates"]},toolbox:{show:1},calculable:1,xAxis:[{type:"category",data:t.category,axisLabel:{rotate:-45,fontSize:10,color:"#9aa0ac"}}],yAxis:[{type:"value",axisLabel:{fontSize:10,color:"#9aa0ac"}}],series:[{name:"Builds",type:"bar",data:t.builds,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}},{name:"Assignments",type:"bar",data:t.assignments,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}},{name:"Updates",type:"bar",data:t.updates,markPoint:{data:[{type:"max",name:"???"},{type:"min",name:"???"}]},markLine:{data:[{type:"average",name:"???"}]}}],color:["#65a986","#4f8bb7","#d68e41"]})}getChartMode(t,e){let s=(e-t)/24/60/60/1e3;return s<60?"Date":s<700?"Month":"Year"}update(){const t=localStorages.get("OBTCasesStats"),e=[],s=[],a=[],o=[];let i=new Map;const r=dateSelector.getFromTime(),n=dateSelector.getToTime();t.forEach((t,e)=>{if(-1!==e.indexOf("-Agent-")&&t.time>=r&&t.time<=n){const s={name:"",builds:0,assignments:0,updates:0,add:function(t){this.builds+=t.builds,this.assignments+=t.assignments,this.updates+=t.updates},init:function(e,s){e&&(this.name=s,this.builds=t.builds,this.assignments=e.assignments,this.updates=e.updates)}};s.init(i.get(e.split("-")[2].split("@")[0]),e.getName()),s.add(t),i.set(e.split("-")[2].split("@")[0],s)}}),i=new Map([...i.entries()].sort((function(t,e){return(""+t.name).localeCompare(e.name)}))),i.forEach(t=>{e.push(t.name),s.push(t.builds),a.push(t.assignments),o.push(t.updates)}),obtChartCasesPerAgent.init({category:e,builds:s,assignments:a,updates:o})}}const obtChartCasesPerAgent=new obtChartCasesPerAgentSingletone;obtChartCasesPerAgent.init(),updateQueue.push(obtChartCasesPerAgent.update);